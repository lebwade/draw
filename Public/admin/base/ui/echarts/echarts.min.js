var tipOn="{_option_.topsText}"
var indexVm=new Vue({
    el:"#wageIndex",
    data:{
        msg:{},			//3个小框的数据
        bussName:'',
        pageShow:false,
        year:'',
        role:0,
        applyOnOff:0,
        tableList:[],
        waleStatus:0
    },
    ready:function(){
        this.ajaxHtml();
        this.popup();
        this.role=_option_.role;
        this.waleStatus=_option_.welfareStatus;
    },
    methods:{
        ajaxHtml:function(){
            var _self=this;
            $.ajax({
                type:"post",
                url:"/Api/Company/getIndex",
                success:function(d){
                    if(d.errcode==0){
                        _self.msg=d.data;
                        _self.bussName=d.data.corp.name||d.data.corp.brief;
                        _self.applyOnOff=d.data.applyStatus;
                        // _self.applyOnOff=1;
                    }
                },
                error:function (d) {
                    console.log(d);
                }
            });
            $.ajax({
                type:"post",
                url:"/Api/Charts/payReportResourt",
                success:function(d){
                    if(d.errcode==0){
                        _self.tableList=d.data.data4;
                    }
                },
                error:function (d) {
                    Dialog.error(d);
                }
            });
        },
        popup:function(){
            //安心工资条更新日志	是否展示
            //接收推送内容
            $.ajax({
                type: "POST",
                url: "/Api/Index/getNotice",
                data:{},
                success: function(d) {
                    if(d.errcode==0&&d.data.status==1){
                        $("body").append(d.data.content);
                    }
                }
            });
        },
        payTime:function(){
            var _self=this;
            if(this.applyOnOff==1){return false;}
            var namebuss=this.bussName;
            Dialog.customsMessage(
                "<div class='c_dialog_cont'>"+
                "<div class='renew-title-bottom c_box_bet'>"+
                "<span><i class='money-renew c_ft_st'>"+namebuss+"</i></span>"+
                "<span class='renew-title-copy'><i class='technology-renew c_ft_st'></i></span>"+
                "</div>"+
                "<div class='list-box-input'>"+
                "<div class='li-input renew-admin'><div class='inline_block'>联系人：</div><input type='text' id='namep'/></div>"+
                "<div class='li-input renew-admin-phone'><div class='inline_block'>联系电话：</div><input type='text' id='cb-phone'/></div>"+
                "</div>"+
                "</div>",
                function(){
                    var phoneReg = /^1[3|4|5|6|7|8]\d{9}$/;
                    var nameb=$('#namep').val();
                    var phoneb=$('#cb-phone').val();
                    if($('#namep').val()==''){
                        $.pt({target:'#namep',content:"<div class='c_center title-tip '>请填写联系人</div>",width:200});
                        return "prevent";
                    }else if($('#cb-phone').val()==''){
                        $.pt({target:'#cb-phone',content:"<div class='c_center title-tip '>请填写手机号</div>",width:200});
                        return "prevent";
                    }else if( !phoneReg.test(phoneb) ){
                        $.pt({target:'#cb-phone',content:"<div class='c_center title-tip '>请填写正确的手机号</div>",width:200});
                        return "prevent";
                    }else{
                        $.ajax({
                            type:"post",
                            url:"/Api/Wage/applyOpen",
                            async:true,
                            data:{name:nameb,phone:phoneb},
                            success:function(d){
                                if(d.errcode==0){
                                    Dialog.succ('申请成功');
                                    _self.applyOnOff=1;
                                }else{
                                    Dialog.succ(d.errmsg);
                                }
                            },
                            error:function(d){
                                console.log(d);
                            }
                        });
                    };

                },"","申请开通","提交"
            )
        },
        changeUrl:function () {
            return  this.role!=2 ? '/home/Setting/setMatters' : 'javascript:;' ;
        }
    }
})

var VM = {
    api: {
        chartData:"/Api/Charts/chartData", //图表渲染接口
    },
    clickFlag:false,
    postAjax:function(url,data,fun,flag){
        if(VM.clickFlag) return false;
        if(!flag) VM.clickFlag=true;
        $.ajax({
            type: "POST",
            url: url,
            data:data,
            dataType:"json",
            success: function (d) {
                if(d.errcode==0){
                    fun(d);
                }else{
                    Dialog.error(d.errmsg);
                }
                VM.clickFlag=false;
            },
            error:function(){
                Dialog.error("操作失败，出现网络错误，请刷新重试 :-(");
                VM.clickFlag=false;
            }
        });
    }
};
//薪酬趋势报表
function CharLoad(){
    console.log("--")
    var chat=new Vue({
        el:'#form-salary',
        data:{

        },
        ready:function(){
            this.ajaxHtml();
        },
        methods:{
            ajaxHtml:function(){
                var _self=this;
                VM.postAjax(
                    VM.api.chartData,
                    {						 //上传字段
                        type:10,             //图表类型
                    },
                    function(d){
                        indexVm.year=d.data.drop_year[0].name;
                        var obj=d.data;
                        var char={};
                        char.legendData=[];
                        char.seriesData=[];

                        for(var i=0;i<1;i++){
                            char.legendData.push(obj.data[i].title);

                            char.seriesData.push({
                                    name:obj.data[i].title,
                                    type:'bar',
                                    barWidth:'50%',
                                    data:obj.data[i].value,
                                    itemStyle:{
                                        normal:{
                                            color: '#f9c26f',
                                            borderColor:"#f9c26f"
                                        }
                                    },
                                    tooltip: {
                                        formatter: function (params, ticket, callback) {
                                            console.log("tooltip:",params.value)
                                            return [
                                                params.name  + '<br/>',
                                                '实发总额: ' + HR.Utils.formatNumber(parseFloat(params.value).toFixed(2)) + '<br/>'
                                            ].join('');
                                        }
                                    },
                                    dataAll:obj.data[i].month_ration
                                }
                            )
                            char.seriesData.push({
                                    name:obj.data[i].title,
                                    type:'line',
                                    data:obj.data[i].value,
                                    label:{
                                        normal:{
                                            show:false
                                        }
                                    },
                                    itemStyle:{
                                        normal:{
                                            color: '#f9c26f',
                                            borderColor:"#f9c26f"
                                        }
                                    },
                                    tooltip: {
                                        formatter: function (params, ticket, callback) {
                                            return [
                                                params.name  + '<br/>',
                                                '实发金额: ' + (params.value!=0?HR.Utils.formatNumber(parseFloat(params.value).toFixed(2)):params.value) + '<br/>'
                                            ].join('');
                                        }
                                    }
                                    // markLine : {
                                    //     lineStyle: {
                                    //         normal: {
                                    //             type: 'solid',
                                    //             color:"red"
                                    //         }
                                    //     },
                                    //     label:{
                                    //     	normal:{
                                    //     		show:true,
                                    //     		formatter: function (value, index) {
                                    //            	return value.value.toFixed(2);
                                    //            }
                                    //     	}
                                    //     },
                                    //     data : [
                                    //         {type : 'average', name: '平均值'}
                                    //     ]
                                    // }
                                }
                            )
                        }

                        var char1={
                            title: {
                                text: ''
                            },
                            tooltip : {
                                trigger: 'item',
                                axisPointer: {
                                    type: 'cross',
                                    label: {
                                        backgroundColor: '#6a7985'
                                    }
                                }
                            },
                            legend: {
                                data:char.legendData
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {
                                        title:"下载",
                                        show:false
                                    }
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '7%',
                                bottom: '3%',
                                containLabel: true
                            },
                            xAxis : [
                                {
                                    type : 'category',
                                    boundaryGap : true,
                                    data : obj.x,
                                    axisPointer: {
                                        type: 'shadow'
                                    }
                                }
                            ],
                            yAxis : [
                                {
                                    type : 'value'
                                }
                            ],
                            series : char.seriesData
                        }
                        // 第二个参数可以指定前面引入的主题
                        var chart = echarts.init(document.getElementById('report-form'), 'infographic');
                        chart.setOption(char1);
                    },
                    true
                )
            },
        }
    });
}
CharLoad();
$('body').on('click','.dialog-close',function () {
    $('.dialog-mask').hide();
})
$('body').on('click','#i-know-dialog',function () {
    $('.dialog-mask').hide();
})

var resizeWidth=$("#report-form").width();
$(window).resize(function() {
    if(!window.resizeWaiter&&resizeWidth!=$("#report-form").width()){
        resizeWidth=$("#report-form").width();
        window.resizeWaiter = true;
        setTimeout(function(){
            CharLoad();
            window.resizeWaiter = false;
        },300);
    }
});
